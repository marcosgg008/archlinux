"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){var e="object"===("undefined"==typeof chrome?"undefined":_typeof(chrome))&&chrome&&chrome.runtime&&chrome||"object"===("undefined"==typeof browser?"undefined":_typeof(browser))&&browser||{},t=e.runtime.getURL("PATH/").replace("/PATH/",""),n="object"===_typeof(e.i18n)&&"function"==typeof e.i18n.getMessage&&e.i18n.getMessage("@@extension_id")||t.split("://")[1]||"",o="https://www.google.com",s=window.location,i=s.href,c=window.top!==window,t=i.startsWith(o+"/cjg-auth/"+n);c&&t&&e.runtime.sendMessage({cjgAuthUrl:i});var a,u,r,d,p,f,o=i.startsWith(o+"/cjg-apis/"+n),n=i.startsWith(e.runtime.getURL("views/cjg-popup.html"));function l(){document.body.textContent="","object"===_typeof(e.i18n)&&"function"==typeof e.i18n.getMessage&&(document.documentElement.dir=e.i18n.getMessage("@@bidi_dir")||"ltr",document.documentElement.lang=(e.i18n.getMessage("@@ui_locale")||"en").replace("_","-"))}function g(){r||e.runtime.sendMessage({closeAuthPopup:!0})}function m(){e.runtime.sendMessage({reloadAllInstances:!0},g)}function h(){(r?m:g)()}function y(e){cjgApis.session.changeAccount(e,!0).then(m,m),setTimeout(m,1e3)}(t||o||n)&&!c&&("complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?l():window.addEventListener("DOMContentLoaded",l),a=(i.match(/authuser=(\d)/)||[])[1]||null,u=(i.split("access_token=")[1]||"").split("&")[0],i=s.hash.replace("#",""),r=-1!==i.indexOf("--macpopup")&&cjBasics.navigator.mac&&!cjBasics.navigator.opera,i=i.split("--macpopup")[0],s=s.pathname.split("/")[3],d="signin"===s||"signin"===i,p="signout"===s||"signout"===i,f=Boolean(u),cjgApis.session.ready.then(function(){d?cjgApis.account.list({listPages:!1}).then(function(e){var t=e[0];if(a&&"0"!==a)for(var n=0;n<e.length;n++)if(e[n].authuser===a){t=e[n];break}var o=cjgApis.session.account;o.validSession&&o.obfuscatedId===t.obfuscatedId&&o.authuser===t.authuser?h():y(t)},h):p?y(cjgApis.account.noAccountData):f?Promise.all([cjgApis.auth.getTokenInfo(u),cjgApis.account.list({authuser:a})]).then(function(e){var t,n=e[0],e=e[1],o=n.sub;e.forEach(function(e){e.obfuscatedId===o&&o!==cjgApis.session.account.obfuscatedId&&(t=e)}),t?y(t):m()},m):h()}),"undefined"!=typeof document&&(document.body.textContent=""))}();