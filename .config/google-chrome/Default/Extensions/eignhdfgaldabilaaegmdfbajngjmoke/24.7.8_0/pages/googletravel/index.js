"use strict";cjce.registerTemplate("bm-p-googletravel",function(e,n){var i,c,s,l,r,o,d,h="trips",a=!cjBasics.wrif.supported,t=cjBasics.uniqueId.generate(),m="https://www.google.com",u={bm_cid:"googletravel",bm_cst:"1",bm_wiz:"1",bm_iid:t,hl:cjBasics.lang.current},g=n.account.authuser;"0"!==g&&(u.authuser=g);var b,_,j="subscriptions/list/hotels",p="flights/saves",v="transit/tickets",f="settings",B=["flights","explore","transit/",j,p,v],w=[p,j,v,f],T={trips:{iconName:"__mdi:cjg_trips",label:cjBasics.lang.i18n("cj_i18n_00307","Trips"),newTabUrl:!0},explore:{iconName:"__mdi:cjg_travel_explore",label:cjBasics.lang.i18n("cj_i18n_00061","Explore"),newTabUrl:!0},"things-to-do":{iconName:"__mdi:camera_alt",label:cjBasics.lang.i18n("cj_i18n_06628","Things to do"),newTabUrl:!0},flights:{iconName:"__mdi:travel",label:cjBasics.lang.i18n("cj_i18n_00414","Flights"),newTabUrl:!0},hotels:{iconName:"__mdi:hotel",label:cjBasics.lang.i18n("cj_i18n_01030","Hotels"),newTabUrl:!0,external:!1},holidayrentals:{iconName:"__mdi:house",label:cjBasics.lang.i18n("cj_i18n_06630","Holiday rentals"),newTabUrl:!0,external:!1},packages:{iconName:"__mdi:beach_access",label:cjBasics.lang.i18n("cj_i18n_01751","Packages"),newTabUrl:!0},"transit/":{iconName:"__mdi:directions_transit",label:cjBasics.lang.i18n("cj_i18n_06629","Trains"),newTabUrl:!0,divider:!0},settings:{iconName:"__mdi:settings",label:cjBasics.lang.i18n("cj_i18n_00298","Settings"),newTabUrl:!0},relatedHeader:{header:!0,color:!0,label:cjBasics.lang.i18n("cj_i18n_06647","Quick access")},"flights/saves":{iconName:"__mdi:timeline",label:cjBasics.lang.i18n("cj_i18n_01125","Tracked flight prices"),newTabUrl:!0},"subscriptions/list/hotels":{iconName:"__mdi:timeline",label:cjBasics.lang.i18n("cj_i18n_06627","Tracked hotel prices"),newTabUrl:!0},"transit/tickets":{iconName:"__mdi:local_activity",label:cjBasics.lang.i18n("cj_i18n_06626","Your train tickets"),newTabUrl:!0},save:{label:cjBasics.lang.i18n("cj_i18n_06669","Favourite itineraries"),iconName:"__mdi:bookmarks",external:!a&&!n.servicesDatabase.save}};function k(e){var a="/travel/";return"holidayrentals"===e?cjBasics.urlParams.attach(a+"hotels",u)+"&hrf=YAE":cjBasics.urlParams.attach(a+e,u)}function x(e){e=m+"/search?q="+encodeURIComponent(e);"0"!==n.account.authuser&&(e+="&authuser="+n.account.authuser),n.openTab(e)}function N(e,a){var t=m,i={};"save"===e?t+="/collections":"holidayrentals"===e?(t+="/travel/hotels",i.hrf="YAE"):t+="/travel/"+e;e=n.account.authuser;"0"!==e&&(i.authuser=e);i=cjBasics.urlParams.attach(t,i);n.openTab(i)}function C(e,a){var t="hotels"===e||"holidayrentals"===e;(!t||"hotels"!==h&&"holidayrentals"!==h||t&&a)&&(o.cjceSelectedId=e,i.cjceSetPageLabel(T[e].label)),c.hidden="flights"!==e,s.hidden="flights"!==e,l.hidden=!t,r.hidden="transit/"!==e;t=-1!==w.indexOf(e);i.cjceSetBackState(t),h=e}function U(e){C((e=e).startsWith("/flights/saves")||e.startsWith("/travel/flights/saves")?p:e.startsWith("/flights/explore")||e.startsWith("/travel/explore")||e.startsWith("/travel/flights/explore")?"explore":e.startsWith("/travel/subscriptions/list/hotels")?j:-1!==e.indexOf("/travel/transit")?-1!==e.indexOf("/travel/transit/tickets")?v:"transit/":e.startsWith("/flights")||e.startsWith("/travel/flights")?"flights":e.startsWith("/travel/settings")?f:e.startsWith("/travel/guide")||e.startsWith("/travel/things-to-do")?"things-to-do":e.startsWith("/travel/hotels")?"hotels":"trips")}function S(){return cjce.createElement("bm-navlist",{selectedId:a?null:h,items:T,onChange:y,onClick:a?N:y,onNewTab:N})}function y(e,a){if("save"===e)return o.cjceSelectedId=h,void n.pageManager.navigate("save",{listId:"dt_fav_itineraries"});e===h||("hotels"===e||"holidayrentals"===e)||i.cjceSetLoading(!0);var t=k(e);a||h!==(a=e)&&(-1!==B.indexOf(a)||-1!==B.indexOf(h))?d.src=m+t:d.cjceSendFrameCommand({method:"bmCstUpdateState",value:t},m),C(e,!0)}delete T.packages,b={onSubmit:x,submitInNewTab:!0},i=cjce.createElement("bm-ogb",{loading:!a,serviceIcon:"travel",serviceLabel:cjBasics.lang.i18n("cj_i18n_00308","Travel"),pageLabel:a?cjBasics.lang.i18n("cj_i18n_00291","Home"):cjBasics.lang.i18n("cj_i18n_00307","Trips"),drawer:!a,onBack:function(){d.cjceSendFrameCommand({method:"bmCstNavigateBack"},m)},searchbox:a?b:null,bmApis:n,onNewTab:function(){T[h];a?N(h):d.cjceGetCleanUrl(m).then(function(e){e?n.openTab(e):N(h)})}}),e.appendChild(i),(s=cjce.createElement("cjmd-iconbutton",{iconName:T.explore.iconName,label:T.explore.label,onClick:function(){y("explore")}})).hidden=!0,i.cjceAppendChild(s),(c=cjce.createElement("cjmd-iconbutton",{iconName:T[p].iconName,label:T[p].label,onClick:function(){y(p)}})).hidden=!0,i.cjceAppendChild(c),(l=cjce.createElement("cjmd-iconbutton",{iconName:T[j].iconName,label:T[j].label,onClick:function(){y(j)}})).hidden=!0,i.cjceAppendChild(l),(r=cjce.createElement("cjmd-iconbutton",{iconName:T[v].iconName,label:T[v].label,onClick:function(){y(v)}})).hidden=!0,i.cjceAppendChild(r),o=S(),a?((b=cjce.createElement("cjmd-container",{shadow:"thinOnScroll"})).appendChild(o),e.appendChild(b),b=i.cjceSearchboxEl,n.setOnPageDisplayHandler(b.select)):(i.cjceDrawerEl.appendChild(o),_=cjBasics.webRequest.addListener("onBeforeRequest",function(e){delete T["transit/tickets"],delete T["transit/"],T.holidayrentals.divider=!0;var a=S();return o.parentNode.replaceChild(a,o),o=a,_.removeListener(),{cancel:!0}},{types:["xmlhttprequest"],urls:[m+"/u/?/travel/transit/geofencing*",m+"/travel/transit/geofencing*"]},["blocking"]),cjBasics.ajax(m+"/travel/transit/trip/a?authuser="+g).catch(function(){}),cjBasics.webRequest.handleIframeHeaders([m+"/*bm_iid="+t+"*","https://search.google.com/*bm_iid="+t+"*"],{disableOgs:m,useMobileUserAgent:!0,handleSwCache:!0,handleFirefoxInject:!0}),cjBasics.webRequest.addListener("onBeforeRequest",function(e){if(e.initiator===m&&e.url.startsWith(m)&&-1===e.url.indexOf("bm_cid"))return{redirectUrl:cjBasics.urlParams.attach(e.url,u)}},{types:["sub_frame"],urls:[m+"/travel*",m+"/flights*"]},["blocking"]),cjBasics.webRequest.catchAndStop(["https://accounts.google.com/AccountChooser*"+encodeURIComponent("bm_iid="+t)+"*"],function(){n.pageManager.navigate("accountchooser"),y(h,!0)}),cjBasics.webRequest.catchAndStop([m+"/maps*",m+"/search*","https://myactivity.google.com/*","https://support.google.com/*"],function(e){n.openTab(e),y(h,!0)}),cjBasics.webRequest.addListener("onBeforeRequest",function(e){if(-1!==e.url.indexOf("/m=kg1Y1d"))return{cancel:!0}},{types:["script"],urls:["https://www.gstatic.com/_/mss/boq-travel/_/js/k=boq-travel.TravelFrontendUi_mobile_ms*"]},["blocking"]),d=cjce.createElement("bm-iframe",{onMessage:function(e){var a;"googletravelOpenUrl"===e.bm_method?(a=cjBasics.cleanBmUrl(e.bm_value),n.openTab(a)):"googletravelPathUpdate"===e.bm_method&&(U(e.bm_value),i.cjceSetLoading(!1))},src:m+k(h),solid:"#fff",shadow:!0,onLoad:function(){i.cjceSetLoading(!1)}}),e.appendChild(d),n.setOnPageDisplayHandler(function(e){e&&e.navId&&y(e.navId)}))});