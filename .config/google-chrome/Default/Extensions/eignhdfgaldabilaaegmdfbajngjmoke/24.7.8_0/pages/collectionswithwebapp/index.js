"use strict";cjce.registerTemplate("bm-p-collectionswithwebapp",function(r,d){var e=cjBasics.uniqueId.generate(),c="0"===d.account.authuser?null:d.account.authuser,n="https://www.google.com",a=n+"/collections",t={bm_cid:"collectionswithwebapp",bm_iid:e,bm_wiz:"1",bm_cst:"1",authuser:c,pageId:d.account.pageId,hl:cjBasics.lang.current},i=[];c&&i.push("authuser="+c),d.account.pageId&&i.push("pageId="+d.account.pageId);var l=i.length?"?"+i.join("&"):"",o="https://save-pa.googleapis.com/$rpc/google.search.platform.save.v2.SaveService/",m=!0,s={home:{id:"home",iconName:"__mdi:home",label:cjBasics.lang.i18n("cj_i18n_00291","Home"),shortcutId:"359",divider:!0},relatedHeader:{header:!0,color:!0,label:cjBasics.lang.i18n("cj_i18n_01539","Related apps")},search:{iconName:"__mdi:search",label:cjBasics.lang.i18n("cj_i18n_01365","Google Search"),shortcutId:"157"},maps:{label:cjBasics.lang.i18n("cj_i18n_01364","Google Maps"),iconName:"__mdi:place",shortcutId:"101"},shopping:{label:cjBasics.lang.i18n("cj_i18n_00059","Google Shopping"),iconName:"__mdi:local_offer",shortcutId:"129"},destinations:{label:cjBasics.lang.i18n("cj_i18n_01774","Travel Guide"),iconName:"__mdi:explore",shortcutId:"764"}};function u(e,c){e=e?"/collections/list/"+encodeURIComponent(e):"/collections",e=cjBasics.urlParams.attach(e,t);c?A.src=n+e:A.cjceSendFrameCommand({method:"bmCstUpdateState",value:e},n)}var _=cjce.createElement("bm-ogb",{loading:!0,drawer:!0,serviceIcon:"save",serviceLabel:cjBasics.lang.i18n("cj_i18n_00432","Collections"),pageLabel:cjBasics.lang.i18n("cj_i18n_00291","Home"),bmApis:d,onNewTab:function(){A.cjceGetCleanUrl(n).then(function(e){e=e||cjgShortcuts.getUrl("359",d.account);d.openTab(e)})},onBack:function(){u(null)}});r.appendChild(_);var p=_.cjceDrawerEl,j=cjce.createElement("bm-navlist",{selectedId:"home",items:s,onClick:function(e){"home"!==e&&d.pageManager.navigate(e)},onNewTab:function(e,c){c=c.newTabUrl||cjgShortcuts.getUrl(c.shortcutId,d.account);d.openTab(c)}});p.appendChild(j);var h=!1;B().then(function(e){(h=0<e.length)&&(j.remove(),j=cjce.createElement("bm-navlist",{selectedId:"home",isSelector:!0,items:h?[s.home].concat(e):s,onChange:function(e){u("home"===e?null:e)},onNewTab:function(e,c){d.openTab(a+("home"===e?"":"/list/"+e)+l)}}),p.appendChild(j))});var b=cjBasics.urlParams.attach(a,t);function g(e,c,n){c=c||{};c.alt="json",c.prettyPrint="false";c=cjBasics.urlParams.attach(o+e,c);return cjgApis.request(c,{method:"POST",fetchAs:"json",headers:{"Content-Type":"application/json+protobuf"},body:JSON.stringify(n||[])},{account:d.account,pa:!0,key:window.atob("QUl6YVN5QnMtR0pFRHFCQW4wTmlFdjAzbmtXZ0NVVHIydmxhVmww")})}cjBasics.webRequest.handleIframeHeaders([n+"/*bm_iid="+e+"*"],{useMobileUserAgent:!0,handleFirefoxInject:!0});var f={IMAGE:"__mdi:image",ITINERARY:"__mdi:assignment",JOB:"__mdi:work_outline",PLACE:"__mdi:place",RECIPE:"__mdi:restaurant",SHOPPING_PRODUCT:"__mdi:local_offer",SCREENSHOT:"__mdi:photo",TVM_ENTITY:"__mdi:play_circle_outline",WEB_PAGE:"__mdi:news"};function v(){return g("ListLists",{pageSize:"200",fields:"lists(listDescriptor(listId,itemTypes),displayName)"}).then(function(e){var a=[];return e.lists.forEach(function(e){var c=e.listDescriptor,n=c&&c.listId;n&&a.push({id:n,supportsAdditions:!Array.isArray(c.itemTypes)||-1!==c.itemTypes.indexOf("WEB_PAGE"),label:(c=(c=e.displayName)||"").charAt(0).toUpperCase()+c.slice(1),iconName:function(e){var c=e.listDescriptor&&e.listDescriptor.itemTypes;if(!Array.isArray(c))return"__mdi:bookmark_border";for(var n=0;n<c.length;n++){var a=f[c[n]];if(a)return a}return"__mdi:bookmark_border"}(e),newTabUrl:!0})}),a.sort(function(e,c){var n=e.label.toLowerCase(),a=c.label.toLowerCase();return n===a?e.id>c.id?1:-1:a<n?1:-1}),a}).catch(function(){return[]})}function I(){return cjgApis.cache.getItem(d.account,"bm_cache_v31__collections__lists").then(function(e){return Array.isArray(e)?e:[]})}function C(e){return cjgApis.cache.setItem(d.account,"bm_cache_v31__collections__lists",e),e}var w=null;function B(){return w=w||v().then(C,I)}function E(e){var n=cjce.createElement("cjmd-container",{solid:!0,floating:!0}),c=cjce.createElement("bm-ogb",{displayBack:!0,serviceIcon:"save",serviceLabel:cjBasics.lang.i18n("cj_i18n_00432","Collections"),pageLabel:cjBasics.lang.i18n("cj_i18n_06324","Save new item"),onBack:function(){n.remove()},bmApis:d});n.appendChild(c);var a=cjce.createElement("cjmd-container",{scrollable:!0,shadow:"thinOnScroll"});n.appendChild(a);var t=document.createElement("div");t.className="bm-p-collections-form",a.appendChild(t);var i=cjce.createElement("cjmd-textfield",{floatingLabel:!0,label:cjBasics.lang.i18n("cj_i18n_06316","Name")});t.appendChild(i);var l=cjce.createElement("cjmd-textfield",{floatingLabel:!0,label:cjBasics.lang.i18n("cj_i18n_06317","Location (URL)")});t.appendChild(l);var o="_bm_choose_list";B().then(function(e){var c=[{value:"_bm_choose_list",label:cjBasics.lang.i18n("cj_i18n_06320","Add to collection")+"..."}];e.forEach(function(e){e.supportsAdditions&&c.push({value:e.id,label:e.label})});var n=cjce.createElement("cjmd-selectbox",{onChange:function(){o=n.selected},options:c});n.selected=o,t.appendChild(n)});var s=cjce.createElement("cjmd-button",{label:cjBasics.lang.i18n("cj_i18n_01363","Save"),fill:!0,color:!0,onClick:function(){var e,c;_.cjceSetLoading(!0),s.disabled=!0,s.textContent=cjBasics.lang.i18n("cj_i18n_06327","Saving"),A.src="about:blank",e={listId:"_bm_choose_list"!==o&&o||null,webPageUrl:l.cjceValue,title:i.cjceValue},c=[null,null,e.title||null,null,null,null,null,null,[e.webPageUrl||null]],g("AddItems",{fields:"listItems/title"},[null,e.listId?[e.listId]:[null,2,[5]],[c]]).then(function(){m=!0,A.src=b+"&",n.remove()})}});c.cjceAppendChild(s);c=e&&e.title;c&&(i.cjceValue=c);e=e&&e.bkmk;e&&(l.cjceValue=e),r.appendChild(n),setTimeout(function(){i.cjceSelect()})}var S,A=cjce.createElement("bm-iframe",{src:b,solid:"#fff",shadow:!0,onMessage:function(e){var c,n,a,t;"collectionswithwebappUpdatePath"===e.bm_method&&(n=-1!==(c=e.bm_value).indexOf("new-list"),a=-1!==c.indexOf("/list/"),_.cjceSetBackState(n||a),e="home",n?e="new-list":a&&(e=c.split("/list/")[1].split("/")[0]),j.cjceSelectedId=e,t=n?cjBasics.lang.i18n("cj_i18n_06321","New collection"):a?(t=h&&j.cjceGetItemElement(e))&&t.textContent||cjBasics.lang.i18n("cj_i18n_06322","Collection"):cjBasics.lang.i18n("cj_i18n_00291","Home"),_.cjceSetPageLabel(t))},onLoad:function(){m&&(m=!1,_.cjceSetLoading(!1))}});r.appendChild(A);var T=cjce.createElement("cjmd-fab",{mini:!0,color:!0,iconName:"__mdi:link",label:cjBasics.lang.i18n("cj_i18n_06323","Save this"),onClick:function(){E({bkmk:S.url,title:S.title})}});cjBasics.navigator.getActionableUrl().then(function(e){e?(S=e,T.title=cjBasics.lang.i18n("cj_i18n_06323","Save this")+" ("+S.url+")"):T.remove()});e=cjce.createElement("cjmd-fabgroup",{items:[cjce.createElement("gmd-fab",{label:cjBasics.lang.i18n("cj_i18n_06324","Save new item"),onClick:function(){E()}}),T]});r.appendChild(e),d.setOnPageDisplayHandler(function(e){e=e.listId;e&&u(e,!0)})});