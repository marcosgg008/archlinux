"use strict";cjce.registerTemplate("bm-p-adsense",function(e,i){var t,a,n,c,s,r,l,m={},o=(new Date).getDate(),d=["https://www.googleapis.com/auth/adsense.readonly"],u="https://content.googleapis.com/adsense/v1.4/",_=!0;_&&(u="https://adsense.googleapis.com/v2/");var p=window.atob("QUl6YVN5QXBVTVBOVFlnbW55UVUwcGdSSXdEcm42OHdGbXZ2bVp3");function g(e,a){var n,t,e=(n=e,t=a,e="https://www.google.com/adsense/new/",a=i.account.authuser,r?e+="u/"+a+"/"+r+"/":"0"!==a&&((t=t||{}).authuser=a),e+=n||"home",t?cjBasics.urlParams.attach(e,t):e);i.openTab(e)}function h(e){if(!_)return null;var a=new Date;return a.setDate(o-e),{year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate()}}function j(e,a){a=a||{};a.prettyPrint="false";a=cjBasics.urlParams.attach(u+e,a);return cjgApis.request(a,{fetchAs:"json"},{account:i.account,pa:"optional",key:p,requiredScopes:d}).catch(A)}var b,y=[{label:cjBasics.lang.i18n("cj_i18n_00225","Today so far"),reportId:"today",range:"TODAY",start:"today",end:"today"},{label:cjBasics.lang.i18n("cj_i18n_00226","Yesterday"),reportId:"yesterday",range:"YESTERDAY",start:"today-1d",end:"today-1d",previous:{label:cjBasics.lang.i18n("cj_i18n_00227","vs same day last week"),start:"today-8d",end:"today-8d",startDate:h(8),endDate:h(8)}},{label:cjBasics.lang.i18n("cj_i18n_01181","Last 28 days").replace("28","7"),range:"LAST_7_DAYS",start:"today-7d",end:"today-1d",reportId:"last7days",previous:{label:cjBasics.lang.i18n("cj_i18n_01180","vs previous 28 days").replace("28","7"),start:"today-14d",end:"today-8d",startDate:h(14),endDate:h(8)}},{label:cjBasics.lang.i18n("cj_i18n_00228","This month so far"),reportId:"thismonth",range:"MONTH_TO_DATE",start:"startOfMonth",end:"today",previous:{label:cjBasics.lang.i18n("cj_i18n_01179","vs same period last year"),start:"startOfMonth-1y",end:"today-1y",startDate:h(365+o),endDate:h(365)}}];function f(e){c.cjceSetLoading(!1),s||(s=!0,n&&(n.hidden=!0),t.textContent="",e=cjce.createElement("bm-fulldialog",{inline:!0,bmApis:i,onNewTab:function(){g("home")},lockup:{label:cjBasics.lang.i18n("cj_i18n_00179","AdSense")},iconName:"ad_sense",message:e.message,actionLabel:e.actionLabel,actionG:e.actionG,action:e.action}),t.appendChild(e))}function v(){f({message:cjBasics.lang.i18n("cj_i18n_00233","There is no AdSense account attached to this Google account"),actionLabel:cjBasics.lang.i18n("cj_i18n_01543","Switch account"),action:function(){i.pageManager.navigate("accountchooser")}})}function A(e){if(e&&e.body&&e.body.indexOf("noAdSenseAccount"))return v();var a;"not_authorized"===e.cjg_error&&(a=e,f({message:cjBasics.lang.i18n("cj_i18n_00235","Before you can use this page, you need to give access to load your Google AdSense data"),actionLabel:cjBasics.lang.i18n("cj_i18n_01916","Continue with Google"),actionG:!0,action:function(){cjgApis.auth.requestPermissions(i.account,a.cjg_missing_scopes)}}))}function w(e){if(!r)throw v(),new Error("No AdSense Account");var a="accounts/"+r+"/reports",n=cjBasics.lang.current.replace("-","_"),t={fields:"headers/currency,totals",metric:"EARNINGS",startDate:e.start,endDate:e.end,useTimezoneReporting:"true",locale:n};return _&&(a+=":generate",t={dateRange:e.range,languageCode:n,fields:"*",metrics:"ESTIMATED_EARNINGS"},(n=e.range)?t.dateRange=n:(t["startDate.year"]=e.startDate.year,t["startDate.month"]=e.startDate.month,t["startDate.day"]=e.startDate.day,t["endDate.year"]=e.endDate.year,t["endDate.month"]=e.endDate.month,t["endDate.day"]=e.endDate.day)),j(a,t).then(function(e){var a=e.headers[0];return{revenue:(e=(e=e.totals)||[],Array.isArray(e)?e[0]||0:(e=e.cells,Array.isArray(e)&&0!==e.length&&(e=e[0])&&e.value||0)),currency:a.currencyCode||a.currency}})}function C(){var a="bm_cache_v31__adsense__mainaccount",n=j("accounts",{fields:_?"accounts/name":"items/id"}).then(function(e){e=e.accounts||e.items;if(!Array.isArray(e))return null;e=e[0]||{};return(e.name||e.id||"").replace("accounts/","")}).then(function(e){return(r=e)?cjgApis.cache.setItem(i.account,a,e):v(),e});return cjgApis.cache.getItem(i.account,a).then(function(e){if(!r&&e&&"string"==typeof e)return r=e}).then(function(e){if(!e)return n})}function D(r,o,d){return c=r,s=function(e){var a,n,t,c,s=e[0].revenue,i=e[0].currency;o.textContent=s+" "+i,r.previous&&e[1]&&(t=e[1].revenue,e[1].currency===i&&(a=0<(n=c=s-t)?"up":n<0?"down":"neutral",e=document.createDocumentFragment(),(n=cjce.createElement("cjmd-icon",{name:"down"==a?"__mdi:trending_down":"__mdi:trending_up"})).classList.add("bm-p-adsense-card__changeicon"),e.appendChild(n),t=t,s=(0<(t=Math.round(1e3*(s/t-1))/10)?"+":"")+t+"%",c=(t=c,c=i,i=(Math.round(100*Math.abs(t))/100).toString(),(t=i.split(".")[1])?t.length<2&&(i+="0"):i+=".00",i+" "+c)+" ("+s+")",(s=document.createElement("span")).className="bm-p-adsense-card__changetext",s.textContent=c,e.appendChild(s),d.textContent="",d.dataset.type=a,d.appendChild(e)))},new Promise(function(a,e){var n="bm_cache_v31__adsense__reports__"+c.start+"__"+c.end,t=!1;cjgApis.cache.getItem(i.account,n).then(function(e){!t&&e&&s(e)}),l.then(function(){m[n]=!0;var e=[w(c)];return c.previous&&e.push(w(c.previous)),Promise.all(e)}).then(function(e){t=!0,s(e),cjgApis.cache.setItem(i.account,n,e),a()},function(){})});var c,s}function B(){var a,n;s||(a=document.createDocumentFragment(),n=[],y.forEach(function(e){e=function(e){var a=cjce.createElement("cjmd-card",{withPadding:!0,interactive:!0,onClick:function(){g("reporting",{rt:"d",uim:"d",d:e.reportId,ct:e.reportCt||null})}});a.classList.add("bm-p-adsense-card");var n=document.createElement("div");n.className="bm-p-adsense-card__date",n.textContent=e.label,a.appendChild(n);var t,c,s=document.createElement("div");return s.className="bm-p-adsense-card__amount",s.textContent=cjBasics.lang.i18n("cj_i18n_01174","Loading")+"...",a.appendChild(s),e.previous&&((c=document.createElement("div")).className="cjmd-secondarytext bm-p-adsense-card__comparison",c.textContent=e.previous.label,n.appendChild(c),(t=document.createElement("div")).className="bm-p-adsense-card__change",t.textContent="â£",a.appendChild(t)),a.cjceAdsenseLoadContent=function(){return D(e,s,t)},a}(e);n.push(e.cjceAdsenseLoadContent()),a.appendChild(e)}),Promise.all(n).then(function(){c.cjceSetLoading(!1)}),t.textContent="",t.appendChild(a))}c=cjce.createElement("bm-ogb",{drawer:!0,loading:!0,serviceIcon:"ad_sense",serviceLabel:cjBasics.lang.i18n("cj_i18n_00179","AdSense"),pageLabel:cjBasics.lang.i18n("cj_i18n_00291","Home"),bmApis:i,onNewTab:function(){g("home")}}),e.appendChild(c),a=c.cjceDrawerEl,n=cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:refresh",label:cjBasics.lang.i18n("cj_i18n_01182","Refresh reports"),onClick:function(){c.cjceSetLoading(!0),cjgApis.cache.remove(i.account,Object.keys(m)).then(B)}}),c.cjceAppendChild(n),b=cjce.createElement("bm-navlist",{items:[{id:"home",iconName:"__mdi:home",label:cjBasics.lang.i18n("cj_i18n_00291","Home"),newTabUrl:!0,adsensePath:"home"},{iconName:"__mdi:picture_in_picture",label:cjBasics.lang.i18n("cj_i18n_01530","Ads"),newTabUrl:!0,adsensePath:"main/myads-viewall-adunits",adsenseParams:{product:"SELF_SERVICE_CONTENT_ADS"},external:!0},{iconName:"__mdi:admob",label:cjBasics.lang.i18n("cj_i18n_00580","AdMob"),newTabUrl:!0,adsensePath:"main/adMob",adsenseParams:{product:"SELF_SERVICE_G_MOB_DISPLAY_APP"},external:!0},{iconName:"__mdi:campaign_search_display",label:cjBasics.lang.i18n("cj_i18n_01149","Ads for search"),newTabUrl:!0,adsensePath:"main/myads-viewall-adunits",adsenseParams:{product:"SELF_SERVICE_SEARCH_ADS"},external:!0},{iconName:"__mdi:web",label:cjBasics.lang.i18n("cj_i18n_01150","Sites"),newTabUrl:!0,adsensePath:"sites/my-sites",external:!0,divider:!0},{iconName:"__mdi:block",label:cjBasics.lang.i18n("cj_i18n_01151","Blocking controls"),newTabUrl:!0,adsensePath:"main/allowAndBlockAds",external:!0},{iconName:"__mdi:assessment",label:cjBasics.lang.i18n("cj_i18n_01152","Reports"),newTabUrl:!0,adsensePath:"main/viewreports",adsenseParams:{rt:"d",uim:"d"},external:!0},{iconName:"__mdi:trending_up",label:cjBasics.lang.i18n("cj_i18n_01153","Optimalization"),newTabUrl:!0,adsensePath:"opt/opportunities",external:!0,divider:!0},{iconName:"__mdi:payments",label:cjBasics.lang.i18n("cj_i18n_01154","Payments"),newTabUrl:!0,adsensePath:"payments",external:!0},{iconName:"__mdi:settings",label:cjBasics.lang.i18n("cj_i18n_00298","Settings"),newTabUrl:!0,adsensePath:"settings",external:!0}],selectedId:"home",bmApis:i,onNewTab:function(e,a){g(a.adsensePath,a.adsenseParams)}}),a.appendChild(b),t=cjce.createElement("cjmd-container",{scrollable:"noScroll",shadow:"transparentOnScroll"}),e.appendChild(t),l=C(),B()});