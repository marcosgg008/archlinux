"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}cjce.registerTemplate("bm-p-mail",function(i,d){var n="object"===("undefined"==typeof chrome?"undefined":_typeof(chrome))&&chrome&&chrome.runtime&&chrome||"object"===("undefined"==typeof browser?"undefined":_typeof(browser))&&browser||{},m="inbox"===(d.instanceParameters.productId||"mail");cjce.applyTemplate(i,"bm-loading"),m&&i.classList.add("bm-p-mail--bigtop"),i.classList.add("bm-p-mail--inboxview");var t=["https://www.googleapis.com/auth/gmail.labels"],c="https://content.googleapis.com/gmail/v1/",l="https://accounts.google.com",o="https://mail.google.com",r=o+"/mail/",s=r+"u/"+d.account.authuser+"/",_=r+"mu/mp/",u=s+"#",b=u+"label/",p=m?"inbox":"gmail",h=m?cjBasics.lang.i18n("cj_i18n_00421","Inbox"):cjBasics.lang.i18n("cj_i18n_00416","Gmail"),j="#ea4335";m&&(j=d.darkMode?"#669df6":"#1a73e8");var g,a,f,A,v,B,S,I,y,T,N,E,L,w,R,k,C="bm_cache_v31__mail__sessionid",M=m?"tl/priority/":"",U="INBOX",P=!1,H=!1,x=["SMARTLABEL_TRAVEL","SV_I","SMARTLABEL_RECEIPT","SMARTLABEL_FINANCE","SMARTLABEL_SOCIAL","SMARTLABEL_PURE_NOTIF","SMARTLABEL_GROUP","SMARTLABEL_PROMO","IO_UNIM"],O=x.concat(["SNOOZED","DONE","REMINDERS","CHAT","ALL"]),D=m?["INBOX","SNOOZED","DONE","DRAFT","SENT","REMINDERS","TRASH","SPAM"]:["INBOX","STARRED","SNOOZED","IMPORTANT","CHAT","SENT","DRAFT","ALL","SPAM","TRASH"],e='div[style*="translate3d"] div[role="button"]',q=d.darkMode?"dark":"light",F="bm_mail_"+(m?"bigtop":"gmail")+"__theme_"+q+"__"+d.account.authuser+"_"+window.btoa(d.account.obfuscatedId).replace(/=+/,""),W="GMAIL_AT",X=["requestHeaders"];cjBasics.webRequest.extraRequestHeadersSupported&&X.push("extraHeaders");var z,G="",V=r+"mu/*mui="+F+"*",Z=["^smartlabel_personal","^smartlabel_social","^smartlabel_promo","^smartlabel_notification","^smartlabel_group"],J={"^smartlabel_personal":{label:cjBasics.lang.i18n("cj_i18n_00178","Primary"),color:"#ea4335"},"^smartlabel_social":{label:cjBasics.lang.i18n("cj_i18n_00312","Social"),color:"#4285f4"},"^smartlabel_promo":{label:cjBasics.lang.i18n("cj_i18n_00315","Promos"),color:"#1e8e3e"},"^smartlabel_notification":{label:cjBasics.lang.i18n("cj_i18n_00313","Updates"),color:"#fa7b17"},"^smartlabel_group":{label:cjBasics.lang.i18n("cj_i18n_00182","Forums"),color:"#a142f4"},"^io_im,PI":{label:cjBasics.lang.i18n("cj_i18n_00184","Important")},"^u,PI":{label:cjBasics.lang.i18n("cj_i18n_01559","Unread")},"^t,PI":{label:cjBasics.lang.i18n("cj_i18n_00004","Starred")},"^io_im,^u,PI":{label:cjBasics.lang.i18n("cj_i18n_01560","Important & unread")},"^all,^f,PI":{label:cjBasics.lang.i18n("cj_i18n_00303","Sent")},"^all,^r,PI":{label:cjBasics.lang.i18n("cj_i18n_00187","Drafts")},",PI":{label:cjBasics.lang.i18n("cj_i18n_00331","Everything")}},K={"^all":"ALL","^f":"SENT","^i":"INBOX","^io_im":"IMPORTANT","^k":"TRASH","^r":"DRAFT","^s":"SPAM","^t":"STARRED"},Q={INBOX:{label:cjBasics.lang.i18n("cj_i18n_00299","Inbox"),newTabUrl:u,superpuduHash:m?"tl/priority/":"tl/please_redirect_me_google",iconName:"__mdi:inbox",color:j,colorIcon:m},PINNED:{superpuduHash:"tl/search/label%3Apinned"},STARRED:{label:cjBasics.lang.i18n("cj_i18n_00004","Starred"),newTabUrl:u+"starred",superpuduHash:"tl/Starred",iconName:"__mdi:star_outline"},SNOOZED:{label:cjBasics.lang.i18n("cj_i18n_00300","Snoozed"),newTabUrl:u+"snoozed",superpuduHash:"tl/search/in%3Asnoozed",iconName:m?"__mdi:schedule":"__mdi:watch_later",color:m?"#ef6c00":null,colorIcon:m},DONE:{label:cjBasics.lang.i18n("cj_i18n_00301","Done"),newTabUrl:u+"done",superpuduHash:"tl/search/label%3Adone",iconName:"__mdi:bigtop_done",color:"#34a853",colorIcon:!0,divider:m},IMPORTANT:{label:cjBasics.lang.i18n("cj_i18n_00184","Important"),newTabUrl:u+"imp",superpuduHash:"tl/Important",iconName:"__mdi:label_important_outline"},CHAT:{label:cjBasics.lang.i18n("cj_i18n_00185","Chats"),newTabUrl:u+"chats",superpuduHash:"tl/Chats",iconName:"__mdi:--hangout"},SENT:{label:cjBasics.lang.i18n("cj_i18n_00303","Sent"),newTabUrl:u+"sent",superpuduHash:"tl/Sent%20Mail",iconName:"__mdi:send"},REMINDERS:{label:cjBasics.lang.i18n("cj_i18n_00081","Reminders"),newTabUrl:u+"reminders",superpuduHash:"tl/Reminders",iconName:"__mdi:reminder"},DRAFT:{label:cjBasics.lang.i18n("cj_i18n_00187","Drafts"),newTabUrl:u+"drafts",superpuduHash:"tl/Drafts",iconName:m?"__mdi:drafts":"__mdi:insert_drive_file"},ALL:{label:cjBasics.lang.i18n("cj_i18n_00188","All mail"),newTabUrl:u+"all",superpuduHash:"tl/All%20Mail",iconName:"__mdi:stacked_email"},SPAM:{label:cjBasics.lang.i18n("cj_i18n_00306","Spam"),newTabUrl:u+"spam",superpuduHash:"tl/Spam",iconName:"__mdi:report",divider:m},TRASH:{label:cjBasics.lang.i18n("cj_i18n_00005","Bin"),newTabUrl:u+"trash",superpuduHash:"tl/Trash",iconName:"__mdi:delete"},SMARTLABEL_TRAVEL:{label:cjBasics.lang.i18n("cj_i18n_00308","Travel"),iconName:"__mdi:travel",newTabUrl:u+"trips",superpuduHash:"tl/search/category%3Atravel",color:"#9c27b0",colorIcon:!0},SV_I:{label:cjBasics.lang.i18n("cj_i18n_00309","Saved"),iconName:"__mdi:bookmark_border",superpuduHash:"tl/search/label%3Asaved",color:"#4285f4",colorIcon:!0},SMARTLABEL_RECEIPT:{label:cjBasics.lang.i18n("cj_i18n_00310","Purchases"),iconName:"__mdi:shopping_cart",superpuduHash:"tl/search/category%3Apurchases",color:"#795548",colorIcon:!0},SMARTLABEL_FINANCE:{label:cjBasics.lang.i18n("cj_i18n_00311","Finance"),iconName:"__mdi:trending_up",gmailPath:"search/category%3Afinance",superpuduHash:"tl/search/category%3Afinance",color:"#689f38",colorIcon:!0},SMARTLABEL_SOCIAL:{label:cjBasics.lang.i18n("cj_i18n_00312","Social"),iconName:"__mdi:people",superpuduHash:"tl/search/category%3Asocial",color:"#ea4335",colorIcon:!0},SMARTLABEL_PURE_NOTIF:{label:cjBasics.lang.i18n("cj_i18n_00313","Updates"),iconName:"__mdi:flag",superpuduHash:"tl/search/category%3Aupdates",color:"#ff6839",colorIcon:!0},SMARTLABEL_GROUP:{label:cjBasics.lang.i18n("cj_i18n_00182","Forums"),iconName:"__mdi:question_answer",superpuduHash:"tl/search/category%3Aforums",color:"#3f51b5",colorIcon:!0},SMARTLABEL_PROMO:{label:cjBasics.lang.i18n("cj_i18n_00315","Promos"),iconName:"__mdi:local_offer",superpuduHash:"tl/search/category%3Apromotions",color:"#00bcd4",colorIcon:!0},IO_UNIM:{label:cjBasics.lang.i18n("cj_i18n_00316","Low Priority"),iconName:"__mdi:low_priority",superpuduHash:"tl/search/label%3Alowpriority"}},Y={apply:cjBasics.lang.i18n("cj_i18n_01567","Apply"),archive:m?cjBasics.lang.i18n("cj_i18n_01734","Mark done"):cjBasics.lang.i18n("cj_i18n_01579","Archive"),delete:cjBasics.lang.i18n("cj_i18n_01563","Delete"),deleteForever:cjBasics.lang.i18n("cj_i18n_01577","Delete forever"),label:cjBasics.lang.i18n("cj_i18n_01571","Label..."),markUnread:cjBasics.lang.i18n("cj_i18n_01573","Mark as unread"),more:cjBasics.lang.i18n("cj_i18n_00047","More"),move:cjBasics.lang.i18n("cj_i18n_01570","Move..."),moveToInbox:cjBasics.lang.i18n("cj_i18n_01575","Move to inbox"),notSpam:cjBasics.lang.i18n("cj_i18n_01576","Not spam"),reportSpam:cjBasics.lang.i18n("cj_i18n_01572","Report spam"),openInNew:cjBasics.lang.i18n("cj_i18n_01545","Open in a new tab"),send:cjBasics.lang.i18n("cj_i18n_01565","Send")},$={archive:m?"__mdi:bigtop_done":"__mdi:archive",openInNew:"__mdi:open_in_new",delete:"__mdi:delete",deleteForever:"__mdi:delete_forever",label:"__mdi:label",markUnread:"__mdi:email",more:"__mdi:more_vert",move:"__mdi:drive_file_move",moveToInbox:"__mdi:move_to_inbox",notSpam:"__mdi:report_off",reportSpam:"__mdi:report",send:"__mdi:send"};function ee(){var e=M.split("/"),a=e[e.length-1],e=cjBasics.numbers.hex2dec(a),a=cjgApis.url.gmailThread.encode({threadId:e,messageId:e}),e="all";M.startsWith("cv/Draft")?e="drafts":M.startsWith("cv/Trash")?e="trash":M.startsWith("cv/Spam")&&(e="spam"),d.openTab(u+e+"/"+a)}function ae(){d.openTab(s+"?view=cm&fs=1&tf=1")}var ne=null,ce={ad:{onBackAction:['#adstopbar [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_01564","Ad"),mainActions:[["button","delete",['#adstopbar [role="button"]',1]]]},co:{onBackAction:['#cvtbt [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_00317","Compose"),mainActions:[["fillbutton","send",['#cvtbt [role="button"]',1]]]},"lb-label":{onBackAction:['#lbttb [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_01566","Label"),mainActions:[["fillbutton","apply",['#lbttb [role="button"]',1]]]},"lb-move":{onBackAction:['#lbttb [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_01568","Move")},cv:{onBackAction:['#cv__cntbt [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_01569","Thread"),mainActions:[["iconbutton","archive",[e]],["iconbutton","delete",[e,1]],["iconbutton","openInNew",ee]],secondaryActions:{move:[e,3,2],label:[e,4,2],reportSpam:[e,6,2],markUnread:[e,8,2]}},"cv-draft":{onBackAction:['#cv__cntbt [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_01574","Draft"),mainActions:[["iconbutton","archive",[e]],["iconbutton","delete",[e,1]],["iconbutton","openInNew",ee]],secondaryActions:{moveToInbox:[e,3,2],label:[e,4,2],markUnread:[e,6,2]}},"cv-spam":{onBackAction:['#cv__cntbt [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_01569","Thread"),mainActions:[["button","notSpam",[e]],["iconbutton","openInNew",ee]],secondaryActions:{deleteForever:[e,2,1],label:[e,3,1],markUnread:[e,5,1]}},"cv-trash":{onBackAction:['#cv__cntbt [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_01569","Thread"),mainActions:[["button","deleteForever",[e]],["iconbutton","openInNew",ee]],secondaryActions:{moveToInbox:[e,2,1],label:[e,3,1],reportSpam:[e,4,1],markUnread:[e,6,1]}},"tl-selection":{onBackAction:[e,-1],label:cjBasics.lang.i18n("cj_i18n_01578","Selection"),mainActions:[["iconbutton","archive",[e]],["iconbutton","delete",[e,1]]],secondaryActions:{move:[e,3,2],label:[e,4,2],reportSpam:[e,6,2],markUnread:[e,7,2]}},"tl-selection-all":{onBackAction:[e,-1],label:cjBasics.lang.i18n("cj_i18n_01578","Selection"),mainActions:[["button","moveToInbox",[e]]],secondaryActions:{archive:[e,2,1],delete:[e,3,1],label:[e,4,1],reportSpam:[e,5,1],markUnread:[e,6,1]}},"tl-selection-draft":{onBackAction:[e,-1],label:cjBasics.lang.i18n("cj_i18n_01578","Selection"),mainActions:[["iconbutton","archive",[e,0]],["iconbutton","delete",[e,1]]],secondaryActions:{moveToInbox:[e,3,2],label:[e,4,2],markUnread:[e,5,2]}},"tl-selection-spam":{onBackAction:[e,-1],label:cjBasics.lang.i18n("cj_i18n_01578","Selection"),mainActions:[["button","notSpam",[e]]],secondaryActions:{deleteForever:[e,2,1],label:[e,3,1],markUnread:[e,4,1]}},"tl-selection-trash":{onBackAction:[e,-1],label:cjBasics.lang.i18n("cj_i18n_01578","Selection"),mainActions:[["button","deleteForever",[e]]],secondaryActions:{moveToInbox:[e,2,1],label:[e,3,1],reportSpam:[e,4,1],markUnread:[e,5,1]}}};function ie(a){var e=a.onBack;Array.isArray(a.onBackAction)&&(e=function(){ge(a.onBackAction)});var l=cjce.createElement("bm-ogb",{displayBack:!0,floating:!0,serviceLabel:h,pageLabel:a.label,onBack:e});if(Array.isArray(a.mainActions)&&a.mainActions.forEach(function(e){var a,n,c,i,t,t=(a=e[0],n=e[1],c=e[2],i=$[n],t={label:Y[n],onClick:function(e){"move"===n?H=!0:"label"===n&&(H=!1),"function"!=typeof c?ge(c):c(e)}},e="cjmd-button","iconbutton"===a?(e="cjmd-iconbutton",t.iconName=i):(t.color=!0,t.hairline="fillbutton"!==a,t.fill="fillbutton"===a),cjce.createElement(e,t));l.cjceAppendChild(t)}),a.secondaryActions){var n,c={};for(n in a.secondaryActions)Array.isArray(a.secondaryActions[n])&&(c[n]={label:Y[n],iconName:$[n]});e=cjce.createElement("cjmd-iconbuttonmenu",{label:cjBasics.lang.i18n("cj_i18n_06294","More actions"),items:c,onClick:function(e){"move"===e?H=!0:"label"===e&&(H=!1),ge(a.secondaryActions[e])}});l.cjceAppendChild(e)}return a.additionalFragment&&l.cjceAppendChild(a.additionalFragment),l}function te(e){ne&&ce[ne]&&ce[ne].toolbar&&(ce[ne].toolbar.hidden=!0),(ne=e)&&((e=ce[e]).toolbar?e.toolbar.hidden=!1:(e.toolbar=ie(e),i.appendChild(e.toolbar)))}function le(){var e=M.startsWith("tl")&&!g,a=!M||e&&("tl/"===M||"tl/Inbox"===M||M.startsWith("tl/priority")||"tl/search/label%3Apinned"===M);i.classList.toggle("bm-p-mail--inboxview",a),M.startsWith("mn")?(je("tl"),te()):M.startsWith("er")||M.startsWith("pr")?(te(),je("tl")):M.startsWith("co")?te("co"):M.startsWith("ad")?te("ad"):M.startsWith("cv/Draft")?te("cv-draft"):M.startsWith("cv/Spam")?te("cv-spam"):M.startsWith("cv/Trash")?te("cv-trash"):M.startsWith("cv")?te("cv"):M.startsWith("lb")?te(H?"lb-move":"lb-label"):te(),f&&(f.hidden=!e)}function oe(e,a){a=a||{};a.prettyPrint="false";a=cjBasics.urlParams.attach(c+"users/me/"+e,a);return cjgApis.request(a,{fetchAs:"json"},{account:d.account,requiredScopes:t})}function re(e){return-1===O.indexOf(e.id)}function se(){return oe("labels",{fields:"labels(id,name,type)"}).then(function(e){var a=e&&e.labels||[],e=a.filter(re).map(function(a){return oe("labels/"+a.id,{fields:"threadsUnread"}).then(function(e){return e&&e.threadsUnread||null},function(){return null}).then(function(e){a.unreadCount=e})});return Promise.all(e).then(function(){return cjgApis.cache.setItem(d.account,"bm_cache_v31__mail__apilabels",a),a})},function(e){if(e&&"not_authorized"===e.cjg_error)return"not_authorized"})}function de(e,n){e.forEach(function(e){var a=Q[e];a.id=e,n.push(a)})}function me(){var e=cjgShortcuts.getUrl("1188",d.account);d.openTab(e)}function _e(e){return cjce.createElement("bm-navlist",{compact:!0,isSelector:!0,selectedId:U,items:e,onChange:function(e,a){if("chat"===e||"meet"===e)return d.pageManager.navigate(e),void(B.cjceSelectedId=U);"REMINDERS"===(U=e)?E?E.hidden=!1:((E=cjce.createElement("cjmd-container")).classList.add("bm-p-mail-sheet","bm-p-mail-reminders"),cjce.applyTemplate(I,"bm-loadingbar"),i.appendChild(E),d.requirePage("reminderswithgapi").then(function(){var e=cjce.createElement("bm-p-reminderswithgapi__reminderslist",{bmApis:d,onLoadChange:function(e){I.cjceSetLoading(e)}});E.appendChild(e)})):(je(a.superpuduHash),E&&(E.hidden=!0)),I.cjceSetPageLabel(a.label),"INBOX"!==e&&i.classList.remove("bm-p-mail--inboxview"),m?(S.style.color=a.colorIcon?a.color:"",y.classList.remove("bm-p-mail-pintoggle--selected")):T&&(T.cjceSelectedId=w,R=w,be()),"INBOX"===e&&i.classList.add("bm-p-mail--inboxview")},onNewTab:function(e,a){a=a.newTabUrl||cjgShortcuts.getUrl(a.shortcutId,d.account);d.openTab(a)}})}function ue(e){return"tl/priority/"+encodeURIComponent(e.replace(",PI",""))}function be(){var e=R&&a[R];e&&(e=e.color,T.style.setProperty("--accent-color",e))}function pe(e){if(!m&&N){if(e.length<2)return N.hidden=!0,void(N.textContent="");w=e[0],Q.INBOX.superpuduHash=ue(w),a={},e.forEach(function(e){a[e]=J[e]}),T=cjce.createElement("cjmd-tabs",{color:j,items:a,onChange:function(e){R=e,be(),je(ue(e))},selectedId:R||w}),N.textContent="",1<e.length&&(N.hidden=!1),N.appendChild(T),be()}}function he(e,a){var n,c=function(c){var e="not_authorized"!==c,a=c,n=[];if(de(D,n),Array.isArray(a)){n.forEach(function(e){for(var a=0;a<c.length;a++)if(c[a].id===e.id){var n="string"!=typeof(n=c[a].unreadCount)&&"number"!=typeof n||"0"===n.toString()?null:n;n&&(e.infoSuffix=n);break}});var i=[],t=m?"__mdi:stacked_email":"__mdi:label";a.forEach(function(e,a){var n,c;"system"!==e.type&&(n=!m&&e.color&&e.color.backgroundColor,Q.TRASH.divider=!m,c=e.name,i.push({id:e.id,theme:"solid",newTabUrl:m?null:b+c,label:c,iconName:t,infoSuffix:e.infoSuffix,color:n,colorIcon:Boolean(n),superpuduHash:"tl/"+c.toLowerCase().replace(/ |\//g,"-")}))}),i.sort(function(e,a){return e.label>a.label?1:-1});for(var l="///////////",o=0;o<i.length;o++){var r=i[o],s=r.label;s.startsWith(l)?(r.label=s.replace(l,""),r.indent=!0):l=s+"/"}n.push({header:!0,color:!0,label:cjBasics.lang.i18n("cj_i18n_06318","Labels")}),n=n.concat(i)}return e||(Q[m?"IO_UNIM":"TRASH"].divider=!0),m&&de(x,n),n[n.length-1].divider=!0,n.push({header:!0,color:!0,label:cjBasics.lang.i18n("cj_i18n_01539","Related apps")},{id:"chat",iconName:"__mdi:chat_bubble_outline",label:cjBasics.lang.i18n("cj_i18n_00819","Chat"),shortcutId:"559",external:!d.servicesDatabase.chat},{id:"meet",iconName:"__mdi:meet",label:cjBasics.lang.i18n("cj_i18n_00809","Meet"),shortcutId:"545",external:!d.servicesDatabase.meet,additionalFragment:cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:video_call",label:cjBasics.lang.i18n("cj_i18n_06916","New meeting"),onClick:me})}),{labels:n,authorized:e}}(e);JSON.stringify(k)!==JSON.stringify(c.labels)&&(k=c.labels,n=v.contains(document.activeElement)&&v.classList.contains("cjmd-sheet--open"),e=B,B=_e(c.labels),cjce.replaceChild(v,B,e),n&&v.cjceToggleState(!0),a&&!c.authorized&&(c=cjce.createElement("bm-inlinepermission",{description:cjBasics.lang.i18n("cj_i18n_01155","To list your labels and give you unread counts, please grant read-only access to your labels and unread count"),onClick:function(){cjgApis.auth.requestPermissions(d.account,t)}}),v.appendChild(c)))}function je(e){A.src=z.split("#")[0]+"#"+e,M=e,le()}function ge(e){A.cjceSendFrameCommand({method:"mailClickEle",value:e},o)}!function(){var a;I=cjce.createElement("bm-ogb",{drawer:{color:"#212121"},serviceIcon:p,serviceLabel:h,pageLabel:cjBasics.lang.i18n("cj_i18n_00299","Inbox"),searchbox:{onClear:function(){g="",f.hidden=!1,i.classList.add("bm-p-mail--inboxview"),ge(['#tltbt [role="button"]'])},onSubmit:function(e){g=e,E&&(E.hidden=!0),f.hidden=!0,i.classList.remove("bm-p-mail--inboxview"),je("tl/search/"+e)}},bmApis:d,onNewTab:function(){var a,n;g?d.openTab(u+"search/"+g):(a=!1,n=B&&B.cjceSelectedId,k&&n&&k.forEach(function(e){e.id===n&&(d.openTab(e.newTabUrl),a=!0)}),a||d.openTab(u))}}),i.appendChild(I),m?((a=document.createElement("div")).className="bm-p-mail-pintoggle",a.title=cjBasics.lang.i18n("cj_i18n_01580","Pinned"),a.addEventListener("click",function(){var e=a.classList.toggle("bm-p-mail-pintoggle--selected");I.cjceSetPageLabel(e?cjBasics.lang.i18n("cj_i18n_01580","Pinned"):cjBasics.lang.i18n("cj_i18n_00299","Inbox")),je(Q[e?"PINNED":"INBOX"].superpuduHash)}),y=a,I.cjceAppendChild(y)):((N=cjce.createElement("cjmd-appbar",{secondary:!0})).classList.add("bm-p-mail-prioritytabs"),I.appendChild(N)),S=I.querySelector(".cjmd-navigator"),m&&S&&(S.style.color=j),(v=I.cjceDrawerEl).classList.add("bm-p-mail-drawer");var e=I.cjceSearchboxEl;e.classList.add("bm-p-mail-searchbox"),d.setOnPageDisplayHandler(e.select),cjBasics.webRequest.handleIframeHeaders([V],{handleFirefoxInject:!0,handleSwCache:!0}),cjBasics.webRequest.handleIframeHeaders([l+"/*"+V,l+"/*"+encodeURIComponent(V)]),n.cookies.get({url:s,name:W},function(e){e&&!G&&(G=e.value)}),cjBasics.webRequest.addListener("onBeforeSendHeaders",function(e){for(var a=e.requestHeaders,n=0;n<a.length;n++){var c=a[n];if("cookie"===c.name.toLowerCase()){c=c.value;-1!==c.indexOf(W)&&(G=c.split(W+"=")[1].split(";")[0]);break}}},{urls:[o+"/*/s*at=*"],types:["xmlhttprequest"]},X),cjBasics.webRequest.addListener("onBeforeRequest",function(e){return{redirectUrl:e.url.replace("at="+F,"at="+G).replace(r,s)}},{urls:[o+"/*/s*at="+F+"*"],types:["xmlhttprequest"]},["blocking"]),cjBasics.webRequest.addListener("onBeforeRequest",function(e){return{redirectUrl:e.url.replace("at="+F,"at="+G)}},{urls:[o+"/*/photos*at="+F+"*"],types:["image"]},["blocking"]),cjgApis.cache.getItem(d.account,C).then(function(e){var a=_+(e?e+"/":"");e&&n.cookies.get({url:a,name:W},function(e){e&&(G=e.value)}),z=cjBasics.urlParams.attach(a,{mui:F,hl:"en",authuser:d.account.authuser}),A=cjce.createElement("bm-iframe",{sandbox:"allow-scripts allow-same-origin allow-popups",src:z+"#"+M,solid:!!d.darkMode||"#fff",shadow:!0,onLoad:function(){i.cjceSetLoading(!1)},onMessage:function(e){var a,n,c=e.bm_method,e=e.bm_value;"mailContentBlocking"===c?cjBasics.navigator.firefox&&(L?L.hidden=!1:((L=cjce.createElement("cjmd-container")).classList.add("bm-p-mail-sheet","bm-p-mail-contentblocking"),n=cjce.createElement("bm-app",{pageId:"pagestateupdate",pageParameters:{contentBlocking:"gmail"},bmApis:d}),L.appendChild(n),i.appendChild(L))):"mailCachedLabels"===c?Array.isArray(e)&&2<e.length&&(n=function(e){for(var a=[],n=[],c={priority:a,other:n},i=!1,t=0;t<e.length;t++){var l=e[t],o=l.id;(i="^all"===o?!0:i)?(n.push(l),o.startsWith("^")&&(l.type="system")):o in J&&a.push(o);o=K[l.id];o&&(l.id=o)}return cjgApis.cache.setItem(d.account,"bm_cache_v31__mail__sqllabels2",c),c}(e),P=!0,pe(n.priority),he(n.other)):"mailHashChange"===c?(M=e,le()):"mailPageUrl"===c?z=e:"mailSessionId"===c?e&&(cjgApis.cache.setItem(d.account,C,e),a=_+e+"/",cjBasics.webRequest.addListener("onBeforeRequest",function(e){return{redirectUrl:e.url.replace(a,s+"s/")}},{urls:[a+"?view=att&*"],types:["image"]},["blocking"])):"mailSelectionState"===c&&(e?M.startsWith("tl/Draft")?te("tl-selection-draft"):M.startsWith("tl/Spam")?te("tl-selection-spam"):M.startsWith("tl/Trash")?te("tl-selection-trash"):M.startsWith("tl/All")?te("tl-selection-all"):M.startsWith("tl")&&te("tl-selection"):te())}}),i.appendChild(A)}),e=[cjce.createElement("gmd-fab",{label:cjBasics.lang.i18n("cj_i18n_00317","Compose"),onClick:function(){je("co")},onMetaClick:ae}),cjce.createElement("cjmd-fab",{mini:!0,color:j,iconName:"__mdi:create",label:cjBasics.lang.i18n("cj_i18n_06325","Compose in new tab"),onClick:ae})],m||e.push(cjce.createElement("cjmd-fab",{mini:!0,color:"#00897b",iconName:"__mdi:video_call",label:cjBasics.lang.i18n("cj_i18n_06916","New meeting"),onClick:me})),f=cjce.createElement("cjmd-fabgroup",{items:e}),i.appendChild(f),"openDatabase"in window||(pe(Z),cjgApis.cache.getItem(d.account,"bm_cache_v31__mail__apilabels").then(function(e){e&&Array.isArray(e)&&(P||he(e))}),se().then(function(e){P||he(e,!0)})),cjgApis.cache.getItem(d.account,"bm_cache_v31__mail__sqllabels2").then(function(e){return"object"===_typeof(e)&&null!==e&&"priority"in e?e:null}).then(function(e){P||e&&(pe(e.priority),he(e.other))})}()});