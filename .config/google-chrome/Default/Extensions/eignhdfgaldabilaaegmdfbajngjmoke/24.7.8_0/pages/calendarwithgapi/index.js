"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}cjce.registerTemplate("bm-p-calendarwithgapi",function(c,o){var i,r,d,l,t,s,m,u,p,h,f,a,g,_,b,j,v,C=["https://www.googleapis.com/auth/calendar"],w=["https://www.googleapis.com/auth/reminders"],y=window.atob("QUl6YVN5Q0FmRFBsWlJMam1nSENKTnVpTVQ2UkNHVFBVVC1CU05F"),S="https://content.googleapis.com/calendar/v3/",E=cjBasics.lang.i18n("cj_i18n_00302","Calendar"),T="https://keep.google.com/"+o.wizPath,B="https://calendar.google.com",k=B+"/calendar/u/"+o.account.authuser+"/",N=k+"r",I=cjBasics.uniqueId.generate(),L=!1,A=!1,D=cjBasics.datetime.fullMonthNames,x=cjBasics.datetime.shortWeekdayNames,e=new Date,n=e.getFullYear(),P=e.getMonth(),R=e.getDate(),M=e.getDay(),e=e.getTime(),F=n+"_"+P.toString(16),O=26784e5,U=e-O,q=e+O,H=new Date(U).toISOString(),V=new Date(q).toISOString(),z=!1,W=o.debugMode&&!0,Y=[16,12,22,1,11,3,13,18,15,7,2],J=["#16a765","#42d692","#4986e7","#7bd148","#92e1c0","#9a9cff","#9fc6e7","#9fe1e7","#a47ae2","#ac725e","#b3dc6c","#b99aff","#c2c2c2","#cabdbf","#cca6ac","#cd74e6","#d06b64","#f691b2","#f83a22","#fa573c","#fad165","#fbe983","#ff7537","#ffad46"],K=["#795548","#e67c73","#d50000","#f4511e","#ef6c00","#f09300","#00897b","#0b8043","#7cb342","#c0ca33","#e4c441","#f6bf26","#33b679","#039be5","#4285f4","#3f51b5","#7986cb","#b39ddb","#616161","#a79b8e","#ad1457","#d81b60","#8e24aa","#9e69af"];function Q(){te(j=!1),g.cjceSendFrameCommand({method:"calendarirenderShowEventClose"},B)}function G(t,n){var e=document.createDocumentFragment(),a=cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:edit",label:cjBasics.lang.i18n("cj_i18n_05629","Edit"),onClick:function(e){pe(t||v,"edit")}});e.appendChild(a);a=cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:delete",label:cjBasics.lang.i18n("cj_i18n_01563","Delete"),onClick:function(e){fe(t||v).then(function(){n&&n.remove(),Q()})}});e.appendChild(a);var c,i,a=(c=t,i=n,cjce.createElement("cjmd-iconbuttonmenu",{compact:!0,label:cjBasics.lang.i18n("cj_i18n_06294","More actions"),items:{duplicate:{iconName:"__mdi:content_copy",label:cjBasics.lang.i18n("cj_i18n_06293","Duplicate")},print:{iconName:"__mdi:print",label:cjBasics.lang.i18n("cj_i18n_02543","Print")}},onClick:function(e){"delete"===e?fe(c||v).then(function(){i&&i.remove()}):pe(c||v,e)}}));return e.appendChild(a),e}function Z(e){var t,n;return"not_authorized"!==e.cjg_error||A||(A=!0,f&&(f.remove(),f.textContent="",f=null),cjgApis.cache.remove(o.account,"bm_cache_v31__calendar__eventlist"),t=cjce.createElement("cjmd-container",{shadow:"thin"}),n=cjBasics.lang.i18n("cj_i18n_00291","Home"),s.cjceSetPageLabel(n),u.hidden=!1,h.hidden=!0,p.hidden=!0,u.classList.remove("bm-p-calendarwithgapi-searchbox"),n=cjce.createElement("bm-fulldialog",{inline:!0,lockup:{label:E},iconName:"calendar",message:cjBasics.lang.i18n("cj_i18n_02176","Before you can use this page, you need to give access to load your __product_name__ data").replace("__product_name__",E),actionLabel:cjBasics.lang.i18n("cj_i18n_01916","Continue with Google"),actionG:!0,action:function(){cjgApis.auth.requestPermissions(o.account,e.cjg_missing_scopes)}}),t.appendChild(n),c.appendChild(t)),Promise.reject(e)}function $(e,t){t=t||{};t.prettyPrint="false";t=cjBasics.urlParams.attach(S+e,t);return cjgApis.request(t,{fetchAs:"json"},{account:o.account,requiredScopes:C}).catch(Z)}function X(e){t=new Intl.DateTimeFormat(cjBasics.lang.current,e)}function ee(t){t={timeStyle:"short",hour:"numeric",minute:"numeric",hour12:!t};try{X(t)}catch(e){delete t.timeStyle,X(t)}}function te(e){!1===e&&j&&(j=!1,s.cjceSetLoading(!0),setTimeout(Ce,1e3)),e!==z&&((z=e)?setTimeout(function(){z&&a.classList.remove("bm-p-calendarwithgapi-inlinerender--hidden")}):a.classList.add("bm-p-calendarwithgapi-inlinerender--hidden"))}function ne(){return $("users/me/calendarList",{maxResults:"250",fields:"items(backgroundColor,foregroundColor,id,selected,summary,colorId)"}).then(function(e){return e.items||[]},function(){return[]})}function ae(e,t){if(e.allday!==t.allday)return e.allday?-1:1;if(e.start!==t.start)return e.start-t.start;if(e.isReminder!==t.isReminder)return e.isReminder?-1:1;var n=(e.title||"").toLowerCase(),a=(t.title||"").toLowerCase();return n!==a?n<a?-1:1:e.eventId<t.eventId?-1:1}function ce(e){return e?e.charAt(0).toUpperCase()+e.slice(1):cjBasics.lang.i18n("cj_i18n_01737","(No title)")}function ie(){return cjgApis.cache.getItem(o.account,"bm_cache_v31__calendar__reminders").then(function(e){return Array.isArray(e)?e:[]})}function re(e){return cjgApis.cache.setItem(o.account,"bm_cache_v31__calendar__reminders",e),e}function oe(e){return t.format(e).replace(" AM","am").replace(" PM","pm")}function de(){return e=q,t=U,n=cjBasics.urlParams.attach("https://reminders-pa.googleapis.com/v1internalOP/reminders/list",{fields:"task(dueDate,title,extensions,externalApplicationLink)",prettyPrint:"false"}),cjgApis.request(n,{method:"POST",fetchAs:"json",headers:{"Content-Type":"application/json"},body:JSON.stringify({includeDeleted:!1,includeArchived:!0,dueBeforeMs:e,dueAfterMs:t})},{pa:!0,key:y,account:o.account,requiredScopes:w}).then(function(e){return e.task.filter(function(e){return e&&e.dueDate&&e.dueDate.year})},function(){return[]}).then(re,ie).then(function(e){return e.map(function(e){var t,n,a=(t=(n=e).dueDate,(n=new Date).setFullYear(t.year),n.setMonth(t.month-1),n.setDate(t.day),(t=t.time)&&(n.setHours(t.hour),n.setMinutes(t.minute),n.setSeconds(t.second)),n),c=a.getTime();return{isReminder:!0,title:ce(e.title),keepData:(n=(n=(n=(t=e).extensions)&&n.keepExtension&&n.keepExtension)&&(n.serverNoteId||n.clientNoteId))?{url:T+"#NOTE/"+n,noteId:n}:(t=(t=t.externalApplicationLink)&&"keepReminder"===t.application&&t.id)?{url:T+"?reminder="+t,reminderId:t}:void 0,start:c,allday:e.dueDate.allDay,timeString:oe(a)}})});var e,t,n}function le(){var e,t=f.querySelector(".bm-p-calendarwithgapi-datebadge--selected");t&&(e=f.scrollTop,t=t.offsetTop-128,Math.abs(e-t)<50||(f.scrollTop=t))}function se(){f&&(f.classList.remove("bm-p-calendarwithgapi-container--smoothscroll"),le(),f.classList.add("bm-p-calendarwithgapi-container--smoothscroll"))}function me(e){e=cjBasics.urlParams.attach(N+"/search",{q:e});o.openTab(e)}function ue(e){return window.btoa(e.eventId+" "+e.calendarId)}function pe(e,t){var n=ue(e),a=k,e={};"edit"===t?a+="r/eventedit/"+n:"duplicate"===t?a+="r/eventedit/duplicate/"+n:e="print"===t?(a+="printevent",{sf:"true",eid:n}):(a+="r/",{eid:n});e=cjBasics.urlParams.attach(a,e);o.openTab(e)}function he(){o.openTab(N+"/eventedit")}function fe(e){var t=encodeURIComponent(e.calendarId),e=encodeURIComponent(e.eventId);return cjgApis.request(S+"calendars/"+t+"/events/"+e,{method:"DELETE"},{account:o.account,requiredScopes:C})}function ge(){var t=[],n=Promise.all([d,r]).then(function(e){return l?de(e[1]):[]}).then(function(e){t=t.concat(e)},function(){});return Promise.all([i,r]).then(function(e){e=e[0].map(function(e){return!0!==e.selected?Promise.resolve():(l=e,$("calendars/"+encodeURIComponent(l.id)+"/events",{timeMin:H,timeMax:V,maxResults:"2500",singleEvents:"true",fields:"items(id,end/dateTime,endTimeUnspecified,start(date,dateTime),summary,colorId)"}).then(function(e){return e.items.map(function(e){var t=new Date(e.start.dateTime||e.start.date+"T12:00:00Z"),n=t.getTime(),a="date"in e.start,c=null;a||(c=oe(t),!e.endTimeUnspecified&&e.end&&e.end.dateTime&&(o=(d=new Date(e.end.dateTime)).getTime(),c+=" - "+oe(new Date(e.end.dateTime)),864e5<o-n&&(c+=" ("+cjBasics.datetime.printDateString(d)+")")));var i,r=e&&e.colorId,t=l.colorId,o=l.backgroundColor,d=o&&-1===J.indexOf(o);!d&&t&&(o=K[Number(t)-1]),r&&(i=o,o=K[Y[Number(r)-1]]);d=!r&&(!t||d)&&"#000000"===l.foregroundColor;return{calendarId:l.id,eventId:e.id,isReminder:!1,backgroundColor:o,sidestampColor:i,lightMode:d,title:ce(e.summary),start:n,allday:a,timeString:c}})},Z).catch(function(){return[]}).then(function(e){e&&(t=t.concat(e))}));var l});return e.push(n),Promise.all(e).then(function(){return t.sort(function(e,t){return e.start-t.start})})})}function _e(n){var e=document.createElement("div");e.classList.add("bm-p-calendarwithgapi-eventlist__item");var t,a=ce(n.title),c=!n.allday;n.isReminder?(e.classList.add("bm-p-calendarwithgapi-eventlist__item--reminder"),c&&(a+=", "+n.timeString),(t=cjce.createElement("cjmd-icon",{theme:"solid",color:"#fff",name:"__mdi:reminders_alt",size:16})).classList.add("bm-p-calendarwithgapi-eventlist__remindericon"),e.appendChild(t)):c&&(a+="\n"+n.timeString),n.backgroundColor&&(e.style.backgroundColor=n.backgroundColor),n.sidestampColor&&(e.style.borderLeftColor=n.sidestampColor),n.lightMode&&e.classList.add("bm-p-calendarwithgapi-eventlist__item--light");var i,r,c=document.createElement("span");return c.classList.add("bm-p-calendarwithgapi-eventlist__label"),c.textContent=a,e.appendChild(c),n.isReminder||((i=document.createElement("div")).className="bm-p-calendarwithgapi-eventlist__tools",e.appendChild(i),r=G(n,e),i.appendChild(r)),n.keepData&&((i=document.createElement("div")).className="bm-p-calendarwithgapi-eventlist__tools",e.appendChild(i),(r=cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:drive_keep",label:cjBasics.lang.i18n("cj_i18n_06300","View related note in Keep")})).classList.add("bm-p-calendarwithgapi-eventlist__keepbutton"),i.appendChild(r)),e.addEventListener("click",function(e){var t=e.target;t===i||i.contains(t)||(n.isReminder?n.keepData&&(t=cjBasics.events.hasMeta(e)||e.shiftKey,e=n.keepData,t?o.openTab(e.url):o.pageManager.navigate("keep",{noteData:e})):W?(j=!1,b=ue(v=n),g.cjceSendFrameCommand({method:"calendarirenderShowEventActivate",value:b},B),setTimeout(function(){te(!(_.hidden=!1))})):pe(n))}),e}function be(e,t){return{fullName:D[t]+" "+e,month:t,dates:[]}}function je(e,t,n,a,c){return{weekdayName:x[a],dateNumber:n,events:[],isToday:c||!1}}function ve(e){var a,o,t;f&&(0!==e.length?(a=document.createDocumentFragment(),(t=e,o={},e=be(n,P),(o[F]=e).dates[R]=je(0,0,R,M,!0),t.forEach(function(e){var t=new Date(e.start),n=t.getFullYear(),a=t.getMonth(),c=t.getDate(),i=n+"_"+a.toString(16),r=o[i];r||(r=be(n,a),o[i]=r);i=r.dates[c];i||(i=je(0,0,c,t.getDay(),!1),r.dates[c]=i),i.events.push(e)}),Object.keys(o).sort().map(function(e){return o[e]})).forEach(function(e,t){var n=document.createElement("div");n.className="bm-p-calendarwithgapi-monthlist",n.dataset.month=e.month,a.appendChild(n),0<t&&((t=document.createElement("div")).className="bm-p-calendarwithgapi-monthlist__header",t.textContent=e.fullName,n.appendChild(t)),e.dates.forEach(function(e){e=function(e){var t=document.createElement("div");t.className="bm-p-calendarwithgapi-monthlist__item";var n=document.createElement("div");n.className="bm-p-calendarwithgapi-datebadge",t.appendChild(n),e.isToday&&n.classList.add("bm-p-calendarwithgapi-datebadge--selected");var a=document.createElement("div");a.className="bm-p-calendarwithgapi-datebadge__date",a.textContent=e.dateNumber,n.appendChild(a),(a=document.createElement("div")).className="bm-p-calendarwithgapi-datebadge__weekday",a.textContent=e.weekdayName,n.appendChild(a);var c=document.createElement("div");return c.className="bm-p-calendarwithgapi-eventlist",t.appendChild(c),0===e.events.length?((a=document.createElement("div")).className="bm-p-calendarwithgapi-eventlist__noresults",a.textContent=e.isToday?cjBasics.lang.i18n("cj_i18n_00267","No events today"):cjBasics.lang.i18n("cj_i18n_06337","No events on this date"),c.appendChild(a)):e.events.sort(ae).forEach(function(e){e=_e(e);c.appendChild(e)}),t}(e);n.appendChild(e)})}),f.textContent="",f.appendChild(a),setTimeout(function(){0===f.scrollTop?f.scrollTop=50:f.scrollTop+f.offsetHeight===f.scrollHeight&&(f.scrollTop-=50)},10)):(f.textContent="",t=cjce.createElement("cjmd-emptystate",{iconName:"__mdi:event",label:cjBasics.lang.i18n("cj_i18n_00265","No events found"),subLabel:cjBasics.lang.i18n("cj_i18n_00266","To add a new event, click the red button in the bottom right corner")}),f.appendChild(t)))}function Ce(){return s.cjceSetLoading(!0),ge().then(function(e){L=!0,cjgApis.cache.setItem(o.account,"bm_cache_v31__calendar__eventlist",e),ve(e),s.cjceSetLoading(!1)})}function we(a,e){var c=cjce.createElement("bm-navitem",{icon:{name:"__mdi:check_box",theme:"solid"},color:function(e){if(e.isRemindersCalendar)return"#3f51b5";var t=e.backgroundColor;return t&&-1===J.indexOf(t)?t:e.colorId&&K[Number(e.colorId)-1]||t||"#1a73e8"}(a),colorIcon:!0,label:a.summary,divider:e});return c.classList.add("bm-p-calendarwithgapi-draweritem"),c.addEventListener("click",function(e){var t,n=c.classList.toggle("bm-p-calendarwithgapi-draweritem--inactive");if(a.isRemindersCalendar)return l=!n,void browserStorage.sync.setItem("bm_pref__calendar__hidereminders",n).then(function(){Ce().then(se)});t=a.id,n=!n,t=S+"users/me/calendarList/"+encodeURIComponent(t)+"?fields=",cjgApis.request(t,{method:"PATCH",body:JSON.stringify({selected:n}),headers:{"Content-Type":"application/json"}},{account:o.account,requiredScopes:C}).catch(Z).then(function(){i=ne(),Ce().then(se)})}),a.selected||c.classList.add("bm-p-calendarwithgapi-draweritem--inactive"),a.isRemindersCalendar||((e=cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:settings",label:cjBasics.lang.i18n("cj_i18n_01254","Settings and sharing"),onClick:function(e){var t;o.openTab(N+"/settings/calendar/"+(t=a.id,window.btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")))}})).classList.add("bm-p-calendarwithgapi-draweritem__settings"),c.appendChild(e)),c}function ye(e){s.cjceSetNavigatorCollapseState(e),s.cjceSetBackState(e),u.hidden=!e,p.hidden=e,h.hidden=e}function Se(e){g.src=cjBasics.urlParams.attach(N,{bm_cid:"calendarirender",bm_iid:I,bm_wiz:"1",bm_cne:a.classList.contains("bm-p-calendarwithgapi-inlinerender--hidden")?null:"1",eid:b,hl:cjBasics.lang.current,bm_cfn:e})}function Ee(){var e,t="Lp",n=!1;cjBasics.webRequest.handleIframeHeaders([k+"*bm_iid="+I+"*"],{disableOgs:B,handleSwCache:!0,handleFirefoxInject:!0}),cjBasics.webRequest.catchAndStop(["https://contacts.google.com/widget/hovercard/*origin=https%3A%2F%2Fcalendar.google.com*"]),function(){(a=cjce.createElement("cjmd-container",{floating:!0,solid:!0})).classList.add("bm-p-calendarwithgapi-inlinerender","bm-p-calendarwithgapi-inlinerender--hidden"),cjce.applyTemplate(a,"bm-loading"),g=cjce.createElement("bm-iframe",{shadow:!0,sandbox:"allow-same-origin allow-scripts",onMessage:function(e){var t,n=e.bm_method,e=e.bm_value;"calendarirenderDialogClose"===n?te(!1):"calendarirenderOpenUrlInNew"===n&&e.startsWith(B)&&(o.openTab(cjBasics.cleanBmUrl(e)),te(!1),t=g.src,g.src="about:blank",setTimeout(function(){g.src=t}))},onLoad:function(){a.cjceSetLoading(!1)}});var e=cjce.createElement("bm-ogb",{displayBack:!0,bmApis:o,serviceLabel:E,pageLabel:cjBasics.lang.i18n("cj_i18n_00268","New event"),onBack:function(){te(j=!1),g.cjceSendFrameCommand({method:"calendarirenderAddEventCancel"},B)}}),t=cjce.createElement("cjmd-button",{label:cjBasics.lang.i18n("cj_i18n_01363","Save"),fill:!0,color:!0,onClick:function(){te(!(j=!0)),g.cjceSendFrameCommand({method:"calendarirenderAddEventSave"},B)}});e.cjceAppendChild(t),a.appendChild(e),(_=cjce.createElement("bm-ogb",{floating:!0,displayBack:!0,bmApis:o,serviceLabel:E,pageLabel:cjBasics.lang.i18n("cj_i18n_06291","Event details"),onBack:function(){Q()}})).hidden=!0,a.appendChild(_),e=G(v),_.cjceAppendChild(e),a.appendChild(g),c.appendChild(a)}(),Se(t),e=cjBasics.urlParams.attach(N,{hl:cjBasics.lang.current,bm_iid:cjBasics.uniqueId.generate()}),cjBasics.ajax(e).then(function(e){e=B+e.split('id="base-js" src="')[1].split('"')[0].replace("m=base","m=tWUEz").replace("/d=1","/d=0");return cjBasics.ajax(e)}).then(function(e){var t,e=e.match(/\.([[a-zA-Z$]{1,3})=function.+dow\.top\.loc/);return e&&(t=e[1],cjgApis.cache.setItem(o.account,"bm_cache_v31__calendar__renderfn",t)),t||null}).then(function(e){n=!0,e&&e!==t&&Se(t=e)}),cjgApis.cache.getItem(o.account,"bm_cache_v31__calendar__renderfn").then(function(e){n||e&&e!==t&&Se(t=e)})}!function(){var t,n,a;d=browserStorage.sync.getItem("bm_pref__calendar__hidereminders").then(function(e){l=!e}),i=ne(),t=!1,n=$("users/me/settings/format24HourTime",{fields:"value"}).then(function(e){t=!0;e="object"!==_typeof(e)||"false"!==e.value&&!1!==e.value;return cjgApis.cache.setItem(o.account,"bm_cache_v31__calendar__24hours",e),ee(e),e},function(){return!0}),r=cjgApis.cache.getItem(o.account,"bm_cache_v31__calendar__24hours").then(function(e){return t||"boolean"!=typeof e?n:(ee(e),e)}),s=cjce.createElement("bm-ogb",{loading:!0,drawer:{keepOpenOnClick:!0},serviceIcon:"calendar",serviceLabel:E,pageLabel:D[P],searchbox:{collapsable:!0,onSubmit:me,submitInNewTab:!0},bmApis:o,onNewTab:function(){o.openTab(N)},onBack:function(){ye(!1)}}),c.appendChild(s),m=s.cjceDrawerEl,(u=s.cjceSearchboxEl).hidden=!0,o.setOnPageDisplayHandler(u.select),h=cjce.createElement("cjmd-button",{hairline:!0,label:cjBasics.lang.i18n("cj_i18n_01253","Today"),onClick:le}),s.cjceAppendChild(h),p=cjce.createElement("cjmd-iconbutton",{label:cjBasics.lang.i18n("cj_i18n_00085","Search"),iconName:"__mdi:search",onClick:function(){ye(!0),u.select()}}),s.cjceAppendChild(p),(a=cjce.createElement("cjmd-container",{scrollable:!0,fabPadding:!0,solid:!0,shadow:"thinOnScroll",onScrollTop:function(){U-=O,H=new Date(U).toISOString(),Ce()},onScrollBottom:function(){q+=O,V=new Date(q).toISOString(),Ce()}})).addEventListener("scroll",function(){for(var e=a.querySelectorAll(".bm-p-calendarwithgapi-monthlist"),t=e[0].dataset.month||P,n=1;n<e.length&&!(a.scrollTop<e[n].offsetTop-68);n++)t=e[n].dataset.month;s.cjceSetPageLabel(D[t])}),f=a,c.appendChild(f),ee(),Ce().then(se),cjgApis.cache.getItem(o.account,"bm_cache_v31__calendar__eventlist").then(function(e){e&&0<e.length&&!L&&(ve(e),se())}),function(){var a=cjce.createElement("cjmd-list");m.appendChild(a),Promise.all([i,d]).then(function(n){n[0].concat({isRemindersCalendar:!0,selected:l,summary:cjBasics.lang.i18n("cj_i18n_00081","Reminders")}).sort(function(e,t){return e.summary<t.summary?-1:1}).forEach(function(e,t){t=we(e,t===n[0].length);a.appendChild(t)}),a.lastChild.classList.add("cjmd-item--divider")});var e={trash:{iconName:"__mdi:delete",label:cjBasics.lang.i18n("cj_i18n_00005","Bin"),newTabUrl:N+"/trash",external:!0},settings:{iconName:"__mdi:settings",label:cjBasics.lang.i18n("cj_i18n_00298","Settings"),newTabUrl:N+"/settings",external:!0}},e=cjce.createElement("bm-navlist",{items:e,onNewTab:function(e,t){t=t.newTabUrl||cjgShortcuts.getUrl(t.shortcutId,o.account);o.openTab(t)}});m.appendChild(e)}();var e=cjce.createElement("gmd-fab",{label:cjBasics.lang.i18n("cj_i18n_00268","New event"),onClick:function(){j=!(b=null),g.cjceSendFrameCommand({method:"calendarirenderAddEventActivate"},B),setTimeout(function(){te(_.hidden=!0)})},onMetaClick:he});c.appendChild(e),Ee()}()});