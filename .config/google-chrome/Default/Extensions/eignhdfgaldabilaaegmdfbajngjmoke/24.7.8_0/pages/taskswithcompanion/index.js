"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}cjce.registerTemplate("bm-p-taskswithcompanion",function(n,i){var s,o,r,t="https://mail.google.com",l="https://tasks.google.com",e="/"+i.wizPath+"embed/",m=l+e,e=cjgApis.companion.getInitData(),u=e.id,h=e.hash,a=e.parameters,d=cjBasics.uniqueId.generate(),_=cjBasics.lang.i18n("cj_i18n_06917","My Tasks"),f="list/",p="list/~default",b=p,g=[{id:p,label:_}],j=[],c="",v={bm_cid:"taskswithcompanion",bm_iid:d,bm_cst:"1",bm_wiz:"1",hl:cjBasics.lang.current,fullWidth:"1"};function y(e){e=cjBasics.urlParams.attach(m+(e||f),{fullWidth:"1",origin:t});i.openTab(e)}function w(e){e=e&&e.label||_;s.cjceSetPageLabel(e)}function k(){var t=[];g.forEach(function(e){e.iconName="__mdi:list_alt",e.newTabUrl=!0,e.id===b&&w(e),t.push(e)}),Array.isArray(j)&&0<j.length&&(t.push({header:!0,color:!0,label:cjBasics.lang.i18n("cj_i18n_06918","Rooms")}),j.forEach(function(e){e.iconName="__mdi:group",e.newTabUrl=!0,e.id===b&&w(e),t.push(e)}));var e=JSON.stringify(t.map(function(e){return[e.id,e.label]}));e!==c&&(c=e,e=cjce.createElement("bm-navlist",{isSelector:!0,selectedId:b,items:t,onChange:function(e,t){s.cjceSetLoading(!0),w(t),r.hidden=e.startsWith("room/"),o.src=cjBasics.urlParams.attach(m+e,v)},onNewTab:function(e){y(e)}}),s.cjceDrawerEl.textContent="",s.cjceDrawerEl.appendChild(e))}function A(e,t){var a=t.indexOf(e);return t.substring(a+e.length)}function C(e,t){e=t.lastIndexOf(e);return t.substring(0,e)}function T(e){var t=A("AF_initDataCallback({key: 'ds:1'",e);t=C("sideChannel:",A(" data:",t)),t=C("]",t)+"]";t=JSON.parse(t);return(t[5]||t[8]).map(function(e){return{id:"room/"+e[0][1],label:e[2]}})}function S(){o.cjceSendFrameCommand({method:"bmCstClickDomElement",value:'body > div > c-wiz > div[role="menu"] div[role="separator"] + [aria-label][role="menuitem"]'},l)}Object.keys(a).forEach(function(e){v[e]=a[e]}),function(){s=cjce.createElement("bm-ogb",{loading:!0,drawer:!0,serviceIcon:"tasks",bmApis:i,onNewTab:function(){y(b)},serviceLabel:cjBasics.lang.i18n("cj_i18n_00439","Tasks"),pageLabel:_}),n.appendChild(s),r=cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:post_add",label:cjBasics.lang.i18n("cj_i18n_06919","Create a new list"),onClick:function(){o.cjceSendFrameCommand({method:"bmCstClickDomElement",value:"h2 + div > div:first-child[data-allow-task-list-reordering] > div"},l),setTimeout(S),setTimeout(S,10),setTimeout(S,50),setTimeout(S,100),setTimeout(S,200),setTimeout(S,300),setTimeout(S,500)}}),s.cjceAppendChild(r),cjBasics.webRequest.handleIframeHeaders([l+"/*bm_iid="+d+"*"],{handleFirefoxInject:!0,handleSwCache:!0});var e,a=!1,c=!1;e="https://chat.google.com/"+i.wizPath,cjBasics.ajax(e+"?shell=9").then(T).catch(function(){return cjBasics.ajax(e+"?shell=8").then(T)}).catch(function(){return[]}).then(function(e){c=!0,0<e.length&&cjgApis.cache.setItem(i.account,"bm_cache_v31__tasks__rooms",e),j=e,k()}),Promise.all([cjgApis.cache.getItem(i.account,"bm_cache_v31__tasks__activeview"),cjgApis.cache.getItem(i.account,"bm_cache_v31__tasks__tasklists"),cjgApis.cache.getItem(i.account,"bm_cache_v31__tasks__rooms")]).then(function(e){e[0]&&(b=e[0]);var t=e[1];!a&&Array.isArray(t)&&0<t.length&&(g=t);e=e[2];!c&&Array.isArray(e)&&0<e.length&&(j=e),k()});var t=cjBasics.urlParams.attach(m+f,v)+h;o=cjce.createElement("bm-iframe",{src:t,solid:"#fff",shadow:!0,sandbox:"allow-scripts allow-forms allow-same-origin allow-popups",onLoad:function(){s.cjceSetLoading(!1)},onMessage:function(e){if("object"===_typeof(e)&&"taskswithcompanionData"===e.bm_method)return a=!0,t=e.bm_value,b=t.activeView||p,0<(t=t.tasklists).length&&(g=t,cjgApis.cache.setItem(i.account,"bm_cache_v31__tasks__tasklists",g)),b.startsWith("list/")&&cjgApis.cache.setItem(i.account,"bm_cache_v31__tasks__activeview",b),void k();var t,e=cjgApis.companion.handleOpenUrlMessage(e,u,i.account);e&&i.openTab(e)}}),n.appendChild(o)}()});