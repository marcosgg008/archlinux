"use strict";cjce.registerTemplate("bm-p-currentshybrid",function(i,c){var n,t,a,s,o,l,r,m,d,u=!cjBasics.wrif.supported||!cjgApis.session.account.validSession,b="#1a73e8",p=cjBasics.lang.i18n("cj_i18n_01772","Currents"),g=cjBasics.lang.i18n("cj_i18n_00417","Google+"),h=p,j="/"+c.wizPath,_="https://currents.google.com",f="https://plus.google.com",e=f+j,v=_+j,w=v,B=v,C=c.account.obfuscatedId,S=!1,T=["stream","tags","communities","me","people","notifications","discover","collections","explore","settings"];var U,N,x,W,k,L,y,P,E,I={stream:{label:cjBasics.lang.i18n("cj_i18n_00291","Home"),iconName:"__mdi:home",newTabUrl:""},tags:{label:cjBasics.lang.i18n("cj_i18n_06609","Tags"),iconName:"__mdi:tag",newTabUrl:"tags/recommended"},discover:{label:cjBasics.lang.i18n("cj_i18n_00926","Discover"),iconName:"__mdi:explore",newTabUrl:"discover"},explore:{label:cjBasics.lang.i18n("cj_i18n_00485","Whatâ€™s hot"),iconName:"__mdi:whatshot",newTabUrl:"explore",divider:!0},collections:{label:cjBasics.lang.i18n("cj_i18n_00292","Collections"),iconName:"__mdi:google_collections",newTabUrl:"collections"},communities:{label:cjBasics.lang.i18n("cj_i18n_00293","Communities"),iconName:"__mdi:communities",newTabUrl:"communities"},me:{label:cjBasics.lang.i18n("cj_i18n_00294","Profile"),iconName:"__mdi:account_circle",newTabUrl:C},people:{label:cjBasics.lang.i18n("cj_i18n_00295","People"),iconName:"__mdi:people",newTabUrl:"people"},notifications:{label:cjBasics.lang.i18n("cj_i18n_00296","Notifications"),iconName:"__mdi:notifications",newTabUrl:"notifications/all",divider:!0},settings:{label:cjBasics.lang.i18n("cj_i18n_00298","Settings"),iconName:"__mdi:settings",newTabUrl:"settings"},up:{label:cjBasics.lang.i18n("cj_i18n_06610","Join Currents"),iconName:"__mdi:login",newTabUrl:"up"}};function A(e){return e.map(function(e){var n=I[e];return n.id=e,n})}function G(e){c.openTab(w+e)}function O(e,n){G(n.newTabUrl)}function D(e,n){var i=n.newTabUrl,n=("collections"===e||"communities"===e||"people"===e||"stream"===e)&&o.value;n&&(i="s/"+encodeURIComponent(n),"stream"!==e&&(i+="/"+e)),G(i)}function R(e){G("s/"+encodeURIComponent(e))}function z(){G("")}function H(){i.textContent="",a=cjce.createElement("bm-ogb",{serviceIcon:"currents",serviceLabel:h,pageLabel:cjBasics.lang.i18n("cj_i18n_01167","Links"),searchbox:{color:b,submitInNewTab:!0,onSubmit:R},bmApis:c,onNewTab:z}),i.appendChild(a),o=a.cjceSearchboxEl,c.setOnPageDisplayHandler(o.select);var e=cjce.createElement("cjmd-container",{scrollable:!0,shadow:"thinOnScroll"});i.appendChild(e),U=A(T),s=cjce.createElement("bm-navlist",{color:!0,items:U,onClick:D,onNewTab:D}),e.appendChild(s)}function q(){m.cjceGetCleanUrl(_).then(function(e){e?c.openTab(e):G("back"===x?"":x)})}function F(e){var n=cjBasics.urlParams.attach(e,E),i=++y;L.then(function(){y===i&&m.cjceSendFrameCommand({method:"bmCstUpdateState",value:n})})}function M(e,n){var i=I[e];!n&&x===e||(x=e,F(j+i.newTabUrl),a.cjceSetPageLabel(i.label))}function J(){s=cjce.createElement("bm-navlist",{isSelector:!0,selectedId:x,items:U,onChange:function(e){M(e)},onNewTab:O}),l.textContent="",l.appendChild(s)}function V(){return cjBasics.urlParams.attach(B+function(){if(!s)return"";var e=s.cjceSelectedId;return"string"==typeof(e=I[e].newTabUrl)?e:""}(),E)}function K(e){!1===k&&(k=!0,W()),x="/"===(e=e)||"/stream"===e||"/stream/"===e?"stream":"/discover"===e||"/discover/"===e?"discover":e.startsWith("/settings")?"settings":e.startsWith("/people")||e.startsWith("/circles")?"people":e.startsWith("/notifications")?"notifications":e.startsWith("/tags")?"tags":"/me"===e||"/me/"===e||e==="/"+C||e==="/"+C+"/"||e==="/"+C+"/posts"||e==="/"+C+"/posts/"?"me":e.startsWith("/explore")?"explore":e.startsWith("/up")?"up":"/s"===e||e.startsWith("/s/")?"search":"/collections"===e||"/collections/"===e||e.startsWith("/collections/featured")||e.startsWith("/collections/followed")||e.startsWith("/collections/yours")?"collections":"/communities"===e||"/communities/"===e||e.startsWith("/communities/member")||e.startsWith("/communities/member/")||e.startsWith("/communities/yours")||e.startsWith("/communities/yours/")?"communities":"back",r.hidden="back"!==x,a.cjceSetBackState("search"===x),d.hidden=!S||!("stream"===x||"search"===x),"back"!==x&&(s.cjceSelectedId=x,I[x]&&a.cjceSetPageLabel(I[x].label))}function Q(){o.value="",o.focus(),a.cjceSetNavigatorCollapseState(!1),M(N,!0)}function X(){var e;n||(n=!0,U=A(["communities","notifications","collections","discover","explore","up"]),x=N="up",a.cjceSetPageLabel(I[x].label),J(),e=V(),m?m.src=e:L.then(function(){m.src=e}))}function Y(e){var n;t&&!e||(t=!0,n=cjBasics.lang.i18n("cj_i18n_01773","__product_name__ is only available for G Suite accounts.").replace("G Suite",cjBasics.lang.i18n("cj_i18n_06682","Workspace")).replace("__product_name__",h),e&&(n=cjBasics.lang.i18n("cj_i18n_00336","Google+ is not available for your organization. Please contact your administrator to enable this service for at least one user in the organization.").replace(g,p)),i.textContent="",n=cjce.createElement("bm-fulldialog",{bmApis:c,onNewTab:z,lockup:{label:h},iconName:"currents",message:n,actionLabel:cjBasics.lang.i18n("cj_i18n_01543","Switch account"),action:function(){c.pageManager.navigate("accountchooser")}}),i.appendChild(n))}function Z(){cjgApis.info.getUserDomain(c.account).then(function(e){e||Y()}),(c.account.validSession?cjBasics.ajax(e).then(function(e){return e||""},function(e){return e&&e.body||""}).then(function(e){return-1!==e.indexOf("Join Google+")||-1!==e.indexOf('rel="canonical" href="https://plus.google.com/discover')?"disabled":-1!==e.indexOf("<title>Google</title>")?"disabledAdministrator":"enabled"}):Promise.resolve("invalidSession")).then(function(e){!0!==e&&("disabled"!==e&&"invalidSession"!==e?"disabledAdministrator"===e&&Y(!0):X())})}u?H():(u=!0,setTimeout(function(){u&&!t&&H()},4e3),U=A(T),x=N="stream",k=!1,L=new Promise(function(e){W=e}),y=0,P=cjBasics.uniqueId.generate(),E={bm_cid:"currentshybrid",bm_cst:"2",bm_wiz:"1",bm_iid:P,hl:cjBasics.lang.current},cjBasics.webRequest.handleIframeHeaders([_+"/*bm_iid="+P+"*",f+"/*bm_iid="+P+"*"],{handleFirefoxInject:!0}),function(){Z();var e=function(){var e=cjce.createElement("cjmd-container"),n=V();m=cjce.createElement("bm-iframe",{src:n,solid:"#fff",onLoad:function(){a.cjceSetLoading(!1)},onMessage:function(e){var n=e.bm_method,e=e.bm_value;"currentshybridWebsiteOrigin"===n?(u=!1,e===f&&(B=e+j)):"currentshybridPageTitle"===n?"back"===x&&r.cjceSetPageLabel(e):"currentshybridWebsiteView"===n?K(e):"currentshybridGsuiteLimit"===n?(d.cjceChecked=e,S||(S=!0,"stream"!==x&&"search"!==x||(d.hidden=!1))):"bmCstOpenUrl"===n&&(e=cjBasics.cleanBmUrl(e),c.openTab(e))}});var i=cjBasics.webRequest.addListener("onBeforeRedirect",function(e){e.redirectUrl.startsWith(v+"up")&&(X(),i.removeListener(),i=null)},{types:["sub_frame"],urls:[n]});return e.appendChild(m),e}();a=cjce.createElement("bm-ogb",{drawer:{color:!0},loading:!0,serviceIcon:"currents",serviceLabel:h,pageLabel:I[x].label,searchbox:{color:b,onClear:Q,onSubmit:function(e){F("s/"+encodeURIComponent(e))},onMetaSubmit:R},bmApis:c,onNewTab:q,onBack:Q}),i.appendChild(a),l=a.cjceDrawerEl,o=a.cjceSearchboxEl,(d=cjce.createElement("cjmd-switch",{icon:"__mdi:business",onChange:function(){a.cjceSetLoading(!0),m.cjceSendFrameCommand({method:"bmCstClickDomElement",value:'c-wiz > div[data-checked-veid][data-unchecked-veid][jslog][role="checkbox"][title][aria-checked][aria-label]'},_)}})).hidden=!0,a.cjceAppendChild(d),(r=cjce.createElement("bm-ogb",{displayBack:!0,floating:!0,serviceLabel:h,pageLabel:cjBasics.lang.i18n("cj_i18n_01174","Loading"),bmApis:c,onNewTab:q,onBack:Q})).hidden=!0,i.appendChild(r),J(),c.setOnPageDisplayHandler(o.select),i.appendChild(e),M(x)}())});